# 护士管理搜索问题修复说明

## 问题描述

在护士管理界面，搜索某个护士并编辑其信息后，护士管理界面只剩下被编辑的那个人，搜不到其他人。如果只搜索不编辑，则能正常搜到其他人。

## 问题原因

1. **搜索状态未清理**：用户搜索护士时，`searchKeyword` 被设置为搜索关键词
2. **编辑后刷新携带搜索参数**：编辑护士保存后，调用 `loadNurses()` 刷新列表时，仍然携带 `searchKeyword` 参数
3. **后端返回过滤结果**：后端接收到搜索参数，只返回匹配的护士，导致列表只显示被搜索的护士

## 修复方案

### 1. 修改 `loadNurses` 方法

添加 `skipSearch` 参数，允许跳过搜索条件：

```javascript
async loadNurses(forceRefresh = false, skipSearch = false) {
  // ...
  const params = {
    departmentId: this.departmentId,
    // 如果 skipSearch 为 true，则不传递搜索关键词，获取完整列表
    keyword: (skipSearch || !this.searchKeyword) ? undefined : this.searchKeyword,
    page: 1,
    pageSize: 1000
  }
  // ...
}
```

### 2. 修改 `saveNurse` 方法

编辑保存后，跳过搜索参数并清空搜索关键词：

```javascript
// 编辑保存后，跳过搜索参数，重新加载完整列表
await this.loadNurses(true, true) // 强制刷新，跳过搜索，获取完整列表
// 清空搜索关键词，让用户看到完整列表
this.searchKeyword = ''
```

### 3. 修改删除护士逻辑

确保删除护士后也清空搜索状态：

```javascript
setTimeout(async () => {
  await this.loadNurses(true, true) // 强制刷新，跳过搜索，获取完整列表
  this.searchKeyword = '' // 清空搜索关键词
  await this.loadTodaySchedules()
}, 500)
```

## 修复效果

修复后的行为：

1. **搜索功能正常**：用户可以正常搜索护士
2. **编辑后显示完整列表**：编辑护士保存后，自动清空搜索条件，显示所有护士
3. **删除后显示完整列表**：删除护士后，也会清空搜索条件，显示所有护士
4. **用户体验改善**：用户不会困惑为什么编辑后只能看到一个护士

## 技术细节

### 前端过滤 vs 后端过滤

- **搜索时**：使用后端过滤（传递 `keyword` 参数）
- **编辑/删除后**：跳过后端过滤（`skipSearch = true`），获取完整列表
- **显示时**：使用前端过滤（`filteredNurses` 计算属性）

### 状态管理

- `searchKeyword`：搜索关键词
- `nurses`：完整护士列表
- `filteredNurses`：过滤后的显示列表

### 刷新策略

- **forceRefresh**：强制刷新，添加时间戳避免缓存
- **skipSearch**：跳过搜索条件，获取完整列表

## 测试场景

1. **正常搜索**：输入关键词，能正常搜索到匹配的护士
2. **搜索后编辑**：搜索护士 → 编辑信息 → 保存 → 显示完整列表
3. **搜索后删除**：搜索护士 → 删除护士 → 显示完整列表
4. **多次操作**：重复搜索、编辑、删除操作，状态正常

## 相关文件

- `src/pages/department/department.vue`：护士管理页面
- 修改的方法：
  - `loadNurses(forceRefresh, skipSearch)`
  - `saveNurse()`
  - `deleteNurse()`

---

**修复完成后，护士管理的搜索和编辑功能将正常工作！** ✅
