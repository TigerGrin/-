# 自动排班功能使用说明

## 🎯 功能概述

自动排班功能可以根据预设规则，自动生成一周的夜班排班表，大幅提高排班效率。

## 📋 排班规则

### 1. 组长（夜班）排班规则
- **总人数**：8个组长
- **轮转周期**：6天一轮
- **每轮安排**：6个组长上夜班，2个组长轮空
- **说明**：每6天为一个周期，周期内6个组长上夜班，2个轮空，确保公平分配

### 2. N2、N3护士夜班排班规则
- **轮转周期**：6天一个夜班
- **说明**：每6天安排一次夜班，确保工作强度合理

### 3. N1、N0护士夜班排班规则
- **轮转周期**：5天一个夜班
- **说明**：每5天安排一次夜班，相对更频繁

## 🚀 使用方法

### 步骤 1：打开自动排班功能

1. 进入排班管理页面
2. 在页面顶部找到 **"自动排班"** 按钮（橙色按钮，带🤖图标）
3. 点击按钮打开自动排班弹窗

### 步骤 2：确认排班信息

在弹窗中会显示：
- **排班规则**：显示上述三条规则
- **排班范围**：显示当前周的日期范围
- **操作说明**：提示会覆盖当前周的夜班排班

### 步骤 3：执行自动排班

1. 点击 **"开始自动排班"** 按钮
2. 系统会自动：
   - 删除当前周的现有夜班排班
   - 根据规则生成新的夜班排班
   - 批量创建排班记录
3. 等待排班完成（通常几秒钟）

### 步骤 4：查看和调整

1. 自动排班完成后，排班表会自动刷新
2. 可以查看生成的排班结果
3. 如需调整，可以手动修改单个排班

## ⚠️ 注意事项

1. **覆盖现有排班**：自动排班会覆盖当前周的所有夜班排班（组长夜班和护士夜班）
2. **仅排夜班**：自动排班只安排夜班，白班需要手动安排
3. **护士分类**：系统会自动识别护士级别（N4、N3、N2、N1、N0）和是否组长
4. **轮转公平**：算法确保所有护士公平轮转，避免某些护士夜班过多

## 🔧 技术实现

### 算法逻辑

1. **组长夜班分配**：
   - 8个组长按工号排序
   - 每6天一个周期，周期内6个组长上夜班
   - 使用模运算确保公平轮转

2. **N2、N3夜班分配**：
   - 每个护士每6天安排一次夜班
   - 按工号排序，错开排班日期

3. **N1、N0夜班分配**：
   - 每个护士每5天安排一次夜班
   - 按工号排序，错开排班日期

### 数据流程

```
用户点击"自动排班"
    ↓
获取当前周日期和护士列表
    ↓
删除现有夜班排班
    ↓
根据规则生成新排班
    ↓
批量创建排班记录
    ↓
刷新排班表显示
```

## 📊 排班结果示例

自动排班后，排班表会显示：

- **组长(夜班)**：每天一个组长上夜班
- **护士(夜班)**：N2、N3每6天一个，N1、N0每5天一个
- **工时**：夜班默认12小时

## 🐛 常见问题

### Q1: 为什么有些护士没有排到夜班？

**A**: 自动排班只安排夜班，且根据规则：
- N2、N3：6天一个夜班（一周可能只有1个）
- N1、N0：5天一个夜班（一周可能有1-2个）
- 如果护士数量多，可能某些护士本周没有夜班

### Q2: 可以只排部分护士吗？

**A**: 当前版本会自动排所有符合条件的护士。如需部分排班，可以：
1. 先执行自动排班
2. 手动删除不需要的排班

### Q3: 自动排班会排白班吗？

**A**: 不会。自动排班只安排夜班（组长夜班和护士夜班），白班需要手动安排。

### Q4: 如何调整自动排班的结果？

**A**: 自动排班完成后，可以：
1. 点击排班单元格手动修改
2. 删除不需要的排班
3. 添加新的排班

## 💡 使用建议

1. **定期使用**：建议每周开始时使用自动排班功能
2. **手动调整**：自动排班后，根据实际情况手动调整
3. **保存备份**：重要排班可以导出Excel备份
4. **规则调整**：如需修改规则，可以联系开发人员调整算法

## 📝 更新日志

### v1.0.0 (2024-01-XX)
- ✅ 实现组长夜班自动排班（8个组长，6天一轮）
- ✅ 实现N2、N3夜班自动排班（6天一个）
- ✅ 实现N1、N0夜班自动排班（5天一个）
- ✅ 添加自动排班按钮和弹窗
- ✅ 支持批量创建和删除排班

---

**祝您使用愉快！如有问题，请联系技术支持。** 🎉

